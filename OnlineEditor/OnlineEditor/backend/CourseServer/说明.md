

### 项目说明

现在的用户登录需要再请求头 设置  Authorization = `Bearer ${token}`

其中token 是请求login接口响应的数据

```
# python 设置请求头示例
import requests

url = "http://127.0.0.1:8001/server1/V1/user/currentuser/"

payload = {}
headers = {
  'HTTP_CURRENTAUTHORITY': 'user',
  'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyVHlwZSI6InN0dWRlbnQiLCJ1c2VyX2lkIjoxLCJwZXJzb25faWQiOjF9.EPRZzshyTD2YXzMSM3AcEjT3pQ7ekats24TqMG_fifs'
}

response = requests.request("GET", url, headers=headers, data=payload)

print(response.text)
```





### 用户中心接口：

前缀/server1/V1/user/

```
path('register/', views.user_register),
path('login/', views.user_login),
path('logout/', views.user_logout),
path('currentuser/', views.current_user),
path('change_password/', views.change_user_password),
path('icon/', views.edit_usericon),
path('edit_userInfo/', views.edit_userInfo),
path('send_verification_email/', views.send_verify_email),
path('user_course_progress/', views.user_course_progress),
path('updateTag/', views.updateTag)
```

上面示例的接口需要添加/server1/V1/user/前缀

currentuser/响应的数据，其中historys和collects数据需要从新接口获取

   path("user_history_collect/", views.history_collect)  # 新增的接口，反向history和collect



### 课程相关接口

前缀/server2/v1/course

```
urlpatterns = [
    path("topicsByTeacher/", views.TopicsByTeacher, name="TopicsByTeacher"),
    path("courses/<str:topic_title>/", views.Courses, name="Courses"),
    path(
        "courseDetail/<str:topic_title>/<int:id>/",
        views.coursesDetail,
        name="coursesDetail",
    ),
    path("search/", views.search, name="search"),
    path("search/<str:keyword>", views.search_topic),
    path("topic/<str:num>", views.top_topic),
    path("newtopic/", views.new_topic),
    path("binlog/", views.binlog),
    path("binlogs/", views.lastModifiedBinlog),
    path("create/", views.create),
    path("edit/", views.edit),
    path("sort/", views.sort),
    path("delete/", views.delete),
    path("upload_topic_img/", views.upload_topic_img),
    path("upload_course_img/<str:topic_title>/", views.upload_course_img),
    path("delete_img/", views.delete_img),
    path("add_user_progress/", views.add_user_courses_progress),
    path("change_user_progress/", views.user_change_course_progress),
    path("remove_user_progress/", views.remove_user_progress),
    path("add_user_collection/", views.add_user_collection),
    path("delete_user_collection/", views.delete_user_collection),
    path("user_history_collect/", views.history_collect)  # 新增的接口，反向history和collect
]
```

/server2/V1/editor/

```
urlpatterns = [
    path(r"run/interactive/", views.run_interactive, name="execute_interactive"),
    path(r"terminate/", views.terminate, name="terminate"),
    path(r"pic/", views.pic, name="delete_pic"),
]
```

server2/ckeditor/

```
urlpatterns = [
    re_path(r"^upload/", staff_member_required(views.upload), name="ckeditor_upload"),
    re_path(
        r"^browse/",
        never_cache(staff_member_required(views.browse)),
        name="ckeditor_browse",
    ),
]
```



### 部署：

启动两个服务

UserServer

```
nohup python manage.py runserver 0.0.0.0:8001 &
```

CourserServer

```
nohup python manage.py runserver 0.0.0.0:8002 &
```

nginx 相关简单配置

nginx 根据请求url前缀进行代理转发

```
server {
    listen 8000;
    server_name ip地址;
		
		
    location /server1/ {
        proxy_pass http://127.0.0.1:8001/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
		
    location /server2/ {
        proxy_pass http://127.0.0.1:8002/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

